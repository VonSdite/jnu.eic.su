function debug(){return false}function errmsg(){if(!debug()){alert("AJAX通信错误,请与管理员联系");throw"ajax error"}}function changeButtonStyle(e){$("#"+exChangedButton).attr("class","alloc_check_div used");$("#"+e).attr("class","alloc_check_div_click");exChangedButton=e}function GetReqKongKeLst(e,t,n,r){var i=e*60+t;var s=n*60+r;var o=new Array;console.log("bh:"+e+" bm:"+t+" eh:"+n+" em:"+r);for(var u=0;u<arrSKSJ.length;u++){if(i>=arrSKSJ[u].b&&i<=arrSKSJ[u].e||s>=arrSKSJ[u].b&&s<=arrSKSJ[u].e||i<=arrSKSJ[u].b&&s>=arrSKSJ[u].b){o.push(u)}}console.log(o);return o}function allocateSystemInit(){currentUser=GetUserData($("#login_info_user_id").html());var e='<div class="alloc_check_div used" id="cha_xun_ke_biao" title="查询可调人员">\n'+"<p>查询可调人员</p>\n"+"</div>\n"+'<div class="alloc_check_div used" id="cha_xun_kkb" title="查询空课表">\n'+"<p>查询空课表</p>\n"+"</div>\n"+'<div class="alloc_check_div used" id="qiandao_qianli" title="签到签离记录">\n'+"	<p>签到签离记录</p>\n"+"</div>\n"+'<div class="alloc_check_div used" id="cancle_alloc" title="取消或修改一次外调">\n'+"	<p>取消\\修改外调</p>\n"+"</div>\n"+'<div class="alloc_check_div wacd">\n'+"	<p></p>\n"+"</div>\n";$("#alloc_bu_div").hide().html(e).slideDown();if(currentUser.userType!=2){$("#qiandao_qianli,#cancle_alloc").attr("class","alloc_check_div used unable");$("#cha_xun_ke_biao").click(showChaXunKeBiao);$("#cha_xun_kkb").click(showChaXunKKB)}else{$("#cha_xun_ke_biao").click(showChaXunKeBiao);$("#cha_xun_kkb").click(showChaXunKKB);$("#qiandao_qianli").click(showQianDaoQianLi);$("#cancle_alloc").click(showCancleAlloc)}showChaXunKeBiao()}function GetUserData(e){function i(e,t,n){this.userID=e;this.userType=t;this.depart=n}try{if(debug())throw"ajax";var t;$.ajax({url:URL+"/postUserData",data:{},async:false,dataType:"json",type:"POST",success:function(e){t=e}});var n=t}catch(r){console.log(r);var n={_userID:e,_userType:2,_depart:2};errmsg()}console.log(n);var s=new i(n._userID,n._userType,n._depart);return s}function postAllocQueInfo(e){var t=GetReqKongKeLst(e.qBeginHour,e.qBeginMin,e.qEndHour,e.qEndMin);var n=new Array;for(var r=0;r<t.length;r++){n.push({qKongKe:t[r]})}console.log(n);try{if(debug())throw"ajax";var i={qDepart:e.qDepart+1,qYear:e.qYear,qMonth:e.qMonth,qDay:e.qDay,qBeginHour:e.qBeginHour,qBeginMin:e.qBeginMin,qEndHour:e.qEndHour,qEndMin:e.qEndMin,qGender:e.qGender,qArrKK:n};console.log(i);var s;$.ajax({url:URL+"/getAllocInfo",data:i,async:false,dataType:"json",type:"POST",success:function(e){s=e}});var o=new Array;var u=s;arrAllocRequire=s.arrAllocRequire}catch(a){var u={arrAnsPerInfo:[{conformity:"0.3",userID:"2012052201",userName:"邓作恒1",freeTime:"0.3",depart:"2",userType:"3",gender:"1",longPhoneNumber:"13726247196",shortPhoneNumber:"617196",total_alloc_time:"5",recently_alloc_time:"2"}]};errmsg()}if(u.arrAnsPerInfo.length!=0){u.arrAnsPerInfo.sort(function(e,t){if(e.conformity==t.conformity){if(e.userType==t.userType){if(e.total_alloc_time==t.total_alloc_time){if(e.recently_alloc_time==t.recently_alloc_time){return e.gender<t.gender}else{e.recently_alloc_time>t.recently_alloc_time}}else{return e.total_alloc_time>t.total_alloc_time}}else{return e.userType-t.userType>0}}else{return e.conformity-t.conformity<0}})}return u.arrAnsPerInfo}function postAllocFormArr(e){var t=new Array;for(var n=0;n<e.length;n++){var r={strID:e[n]};t.push(r)}var i={jsonITList:t,arrAllocRequire:arrAllocRequire};console.log(i);try{if(debug())throw"ajax";var s;$.ajax({url:URL+"/postAllocCode",data:i,async:false,dataType:"json",type:"POST",success:function(e){s=e}});var o={allocCode:s.code};return o.allocCode}catch(u){errmsg();return"20140828-QWER"}}function getKKBList(){try{if(debug())throw"ajax";var e;$.ajax({url:URL+"/postKongKeBiao",data:{},async:false,dataType:"json",type:"POST",success:function(t){e=t}});var t=e}catch(n){var t={arrKKBLinkList:[{name:"KSC联盟空课表",link:"#"},{name:"人力资源部空课表",link:"#"},{name:"体育部空课表",link:"#"}]};errmsg()}return t.arrKKBLinkList}function postAllocCode(e){try{if(debug())throw"ajax";var t={allocCode:e};var n;$.ajax({url:URL+"/getAllocCode",data:t,async:false,dataType:"json",type:"POST",success:function(e){n=e}});var r=n}catch(i){var r={arrAllocedList:[{ID:"2012052207",name:"邓作恒1",allocResult:"1"}]};errmsg()}return r.arrAllocedList}function postAllocPerfValue(e){var t=new Array;console.log(e);for(var n=0;n<e.length;n++){var r={ID:e[n].ID,BX:e[n].allocResult};t.push(r)}console.log(t);var i=document.forms["code_input"].elements["alloc_code"].value;var s={arrAllocedPerf:t,AllocCode:i};try{if(debug())throw"ajax";var o;$.ajax({url:URL+"/getAllocPerform",data:s,async:false,dataType:"json",type:"POST",success:function(e){o=e}});console.log("发送外调表现结果的返回值:"+o);return true}catch(u){errmsg();return true}}function postAllocCodeforCancel(e){try{if(debug())throw"ajax";var t={allocCode:e};var n;$.ajax({url:URL+"/getAllocCancel",data:t,async:false,dataType:"json",type:"POST",success:function(e){n=e}});var r=n}catch(i){var r={exist:"exist",code:e,applyTime:"2012-13-13 25:60:60",operator:"邓作恒",applyDepart:"KSC联盟",workTime:"2012-14-14 16:30--17:40"}}return r}function cancelAlloc(e){try{if(debug())throw"ajax";var t={allocCode:e};var n;$.ajax({url:URL+"/setAllocCancel",data:t,async:false,dataType:"json",type:"POST",success:function(e){n=e}});console.log(n.back);return true}catch(r){errmsg();return true}}function showChaXunKeBiao(){changeButtonStyle("cha_xun_ke_biao");$("#alloc_work_f").html("<div id='alloc_work_f_inner'></div>");var e='<div id="alloc_q">\n'+'<form name="alloc_q_form" method="post" action="#">\n'+"<h2>申请部门</h2>\n"+'<select class="alloc_select" name="shenqingbumen" id="shengqingbumen">\n';for(var t=0;t<arrDepartName.length;t++){e+='<option value="'+t+'"';if(t==currentUser.depart-1){e+='selected="selected"'}e+=">"+arrDepartName[t]+"</option>\n"}e+="</select><span id='tips_depart'></span>\n"+"<h2>查询条件</h2>\n"+"<p>\n"+"工作日期：\n"+'<select class="alloc_select" name="shijian_nian" id="shijian_nian">\n';var n=new Date;var r=n.getFullYear();e+='<option value="'+r+'">'+r+"</option>";e+='<option value="'+(r+1)+'">'+(r+1)+"</option>";e+="</select>";e+="年\\";e+='<select class="alloc_select" name="shijian_yue" id="shijian_yue">\n';for(var t=0;t<12;t++){e+='<option value="'+(t+1)+'">'+(t+1)+"</option>\n"}e+="</select>"+"月\\"+'<select class="alloc_select" name="shijian_ri" id="shijian_ri">\n';for(var t=0;t<31;t++){e+='<option value="'+(t+1)+'">'+(t+1)+"</option>\n"}e+="</select>\n"+"日\n"+"<span id='tips_work_day'></span>"+"</p>\n"+"<p>\n"+"工作时间：\n"+'<select class="alloc_select" name="shijian_kaishi_h" id="shijian_kaishi_h">\n';for(var t=5;t<19;t++){e+='<option value="'+t+'">'+t+"</option>\n"}e+="</select>\n"+":\n"+'<select class="alloc_select" name="shijian_kaishi_fen" id="shijian_kaishi_fen">';for(var t=0;t<6;t++){e+='<option value="'+t+"0"+'">'+t+"0"+"</option>\n"}e+="</select>\n"+"	— —\n"+'	<select class="alloc_select" name="shijian_jieshu_h" id="shijian_jieshu_h">\n';for(var t=5;t<19;t++){e+='<option value="'+t+'">'+t+"</option>\n"}e+="</select>\n"+":\n"+'<select class="alloc_select" name="shijian_jieshu_fen" id="shijian_jieshu_fen">\n';for(var t=0;t<6;t++){e+='<option value="'+t+"0"+'">'+t+"0"+"</option>\n"}e+='</select><span id=\'tips_work_time\'></span><a href="#" id="help">帮助</a>\n'+"</p>\n"+"<p>\n"+"	性别要求：\n"+'	<select class="alloc_select" name="teshu_sex" id="teshu_sex">\n'+'		<option value="0" selected="selected">不限</option>\n'+'		<option value="1">女</option>\n'+'		<option value="2">男</option>\n'+"	</select>\n"+"</p>\n"+'<div id="time_error" class="alloc_code_error"></div>'+"<p>\n"+'	<button class="alloc_sub_bu" type="button" name="q_submit" id="q_submit" title="提交查询">\n'+"		查询\n"+"	</button>\n"+"</p>\n"+"</form>\n"+"<hr />\n"+"</div>\n"+'<div id="q_result"></div>'+'<div id="alloc_succeed"></div>';$("#alloc_work_f_inner").hide().html(e).slideDown();$("#shengqingbumen").change(function(){$("#tips_depart").html("&emsp;搜索结果中不会显示"+arrDepartName[$(this).val()]+"的人员")});$("#shijian_nian,#shijian_yue,#shijian_ri").change(function(){tips_qYear=parseInt($("#shijian_nian").val());tips_qMonth=parseInt($("#shijian_yue").val());tips_qDay=parseInt($("#shijian_ri").val());var e=new String;Date.prototype.getWeekOfYear=function(e){e=(e||0)-0;if(isNaN(e)||e>6)e=0;var t=this.getFullYear();var n=new Date(t,0,1);var r=7-n.getDay()+e;var i=(new Date(t,this.getMonth(),this.getDate())-n)/(24*3600*1e3)+1;return Math.ceil((i-r)/7)+1};var t=new Date(2014,9,8,1,1,1,1);var n=new Date(tips_qYear,tips_qMonth,tips_qDay);var r=(n.getWeekOfYear(1)-t.getWeekOfYear(1))%2;if(r==0){e+="第"+(n.getWeekOfYear(1)-t.getWeekOfYear(1)+1)+"周,单周"}else{e+="第"+(n.getWeekOfYear(1)-t.getWeekOfYear(1)+1)+"周,双周"}var i=[-1,11,12,1,2,3,4,5,6,7,8,9,10];tips_qMonth=i[tips_qMonth];w=(tips_qDay+parseInt(2.6*tips_qMonth-.2)+5*(tips_qYear%4)+3*tips_qYear+5*(21%4))%7;var s=["一","二","三","四","五","六","日"];e+="星期"+s[w];$("#tips_work_day").html(e)});$("#shijian_kaishi_h,#shijian_kaishi_fen,#shijian_jieshu_h,#shijian_jieshu_fen").change(function(){console.log("计算时间");var e=parseInt($("#shijian_kaishi_h").val());var t=parseInt($("#shijian_jieshu_h").val());var n=parseInt($("#shijian_jieshu_fen").val());var r=parseInt($("#shijian_kaishi_fen").val());if(e*60+r-(t*60+n)>0){$("#tips_work_time").html("*开始时间晚于结束时间，这不科学");return}var i=GetReqKongKeLst(e,r,t,n);if(i.length>0){var s=new String("需要第");for(var o=0;o<i.length;o++){s+=i[o]+1;s+=","}s+="节课没课&emsp;&emsp;";$("#tips_work_time").html(s)}});$("#help").click(function(){alert("此处工作时间用于查询空课表\n"+"系统先用此时间判断那节课需要为空才能符合工作时间\n"+"判断标准如下：\n"+"开始时间在一节课中间的，要求空\n结束时间在一节课中间的，要求空\n在这节课前开始，在这节课前没结束的，要求空");return false});$("#q_submit").click(function(){var e=new String;var t=document.forms["alloc_q_form"];if(2==$("#shijian_yue").val()&&29<$("#shijian_ri").val()){e+="*2月没有"+$("#shijian_ri").val()}var n=parseInt($("#shijian_kaishi_h").val());var r=parseInt($("#shijian_jieshu_h").val());var i=parseInt($("#shijian_jieshu_fen").val());var s=parseInt($("#shijian_kaishi_fen").val());if(n*60+s-(r*60+i)>0){e+="*开始时间晚于结束时间，这不科学\n"}if(e!=""){$("#time_error").html(e);return false}else{$("#time_error").html("");function o(){this.qDepart=parseInt($("#shengqingbumen").val());this.qYear=parseInt($("#shijian_nian").val());this.qMonth=parseInt($("#shijian_yue").val());this.qDay=parseInt($("#shijian_ri").val());this.qBeginHour=parseInt($("#shijian_kaishi_h").val());this.qBeginMin=parseInt($("#shijian_kaishi_fen").val());this.qEndHour=parseInt($("#shijian_jieshu_h").val());this.qEndMin=parseInt($("#shijian_jieshu_fen").val());this.qGender=parseInt($("#teshu_sex").val())}var u=new o;var a=postAllocQueInfo(u);if(a.length!=0){var f=new String;f+="<h2>查询结果</h2>\n"+'	<form method="post" action="#" name="alloc_list_form">\n'+'		<table class="alloc_mb_table">\n'+"			<thead>\n"+"				<tr>\n"+"					<th>调用</th>\n"+"					<th>姓名</th>\n"+"					<th>空课时间</th>\n"+"					<th>所属部门</th>\n"+"					<th>用户类型</th>\n"+"					<th>性别</th>\n"+"					<th>长号</th>\n"+"					<th>短号</th>\n"+"					<th>累计/最近外调数</th>\n"+"				</tr>\n"+"			</thead>\n"+"			<tbody>\n";for(var l=0;l<a.length;l++){f+='<tr><td><input type="checkbox" name="'+a[l].userID+'" value="'+a[l].userID+'"/></td>'+"<td>"+a[l].userName+"</td>"+"<td>"+a[l].freeTime+"</td>"+"<td>"+arrDepartName[a[l].depart-1]+"</td>"+"<td>"+arrTypeName[a[l].userType-1]+"</td>"+"<td>"+arrGenderName[a[l].gender]+"</td>"+"<td>"+a[l].longPhoneNumber+"</td>"+"<td>"+a[l].shortPhoneNumber+"</td>"+"<td>"+(a[l].total_alloc_time+"/"+a[l].recently_alloc_time)+"</td>"+"</tr>"}f+='</tbody></table><div id="verification"><div>';if(currentUser.userType==2){f+='<button class="alloc_sub_bu"	type="button" name="al_submit" id="al_submit" title="调用选中人">\n'+"调用选中人\n"+"</button>\n"+"</form>\n";$("#q_result").hide().html(f).slideDown()}else{$("#q_result").hide().html(f).slideDown()}$("#al_submit").click(function(){var e=document.forms["alloc_list_form"];var t=new Array;for(var n=0;n<a.length;n++){if(true==e.elements[n].checked){t.push(e.elements[n].name)}}var r=postAllocFormArr(t);if(0==t.length){alert("你必须选择你要外调的同学!")}else{var i="<p>调用成功！</p><p>本次外调序列号：</p><p>"+r+"</p>";i+='<div class="alloc_code_error">'+"*请务必记住外调序列号！"+"</div>";i+='<button class="alloc_sub_bu"	type="button" name="al_succeed" id="al_succeed" title="返回前请记住外调序列号">\n'+"确认并返回\n"+"</button>\n";$("#alloc_succeed").hide().html(i).slideDown();$("#al_submit").hide();$("#al_succeed").click(showChaXunKeBiao)}})}else{var f;f="<h2>查询无结果o(╯□╰)o</h2>\n";$("#q_result").html(f)}}})}function showQianDaoQianLi(e){function n(e){var t=/^\d{8}-[A-Z]{4}$/;return t.test(e)}changeButtonStyle("qiandao_qianli");var t=new String;t+='	<div id="code_s_q">\n'+"		<h2>外调序列号</h2>\n"+'		<div id="code_tips">\n'+"			输入外调序列号:\n"+"		</div>\n"+'		<form method="post" action="#" name="code_input">\n'+'			<input type="text" id="alloc_code" name="alloc_code" />\n'+'			<div id="alloc_code_error" class="alloc_code_error"></div>\n'+'			<button type="button" id="alloc_code_sub" name="alloc_code_sub" class="alloc_sub_bu" title="外调序列号提交按钮">确定</button>\n'+"		</form>\n"+"		<hr />\n"+"	</div>\n"+'	<div id="pref_radio_s"></div>\n';$("#alloc_work_f").html("<div id='alloc_work_f_inner'></div>");$("#alloc_work_f_inner").hide().html(t).slideDown();$("#alloc_code_sub").click(function(){var e=$("#alloc_code").val();if(true==n(e)){$("#alloc_code_error").html("");var t=postAllocCode(e);var r=new String;if(0!=t.length){r+="<h2>外调表现表</h2>\n"+'<form method="post" action="#" name="alloc_perf_form_list">\n'+'	<table id="qiandaoqianli_table" class="alloc_mb_table">\n'+"		<thead>\n"+"			<tr>\n"+"				<th>姓名</th>\n"+"				<th>外调表现</th>\n"+"			</tr>\n"+"		</thead>\n"+"		<tbody>\n";var i=new Array("缺席","迟到或早退","一般","表项突出");for(var s=0;s<t.length;s++){r+="<tr><td>"+t[s].name+'</td><td class="width_400">';for(var o=0;o<4;o++){r+='<label for="'+(t[s].ID+"_p"+o)+'">'+i[o]+"</label>"+'<input type="radio" name="'+t[s].ID+'" id="'+(t[s].ID+"_p1")+'" value="'+(o+1)+'" ';if(o==t[s].allocResult-1){r+='checked="checked"'}r+='class="alloc_perf_radio" />'}}r+="</tbody></table>\n"+'<button type="button" id="alloc_pref_sub" name="alloc_pref_sub" class="alloc_sub_bu" title="外调表现表提交按钮">提交</button>\n'+"</form>\n"}else{r+="<h2>找不到"+e+"对应的外调!</h2>"}$("#pref_radio_s").hide().html(r).slideDown();try{$("#alloc_pref_sub").click(function(){for(var n=0;n<t.length;n++){var r=document.getElementsByName(t[n].ID);for(var i=0;i<r.length;i++){if(true==r[i].checked){t[n].allocResult=r[i].value}}}if(true==postAllocPerfValue(t)){alert("外调"+e+"的考核结果提交成功！点击确定返回");showQianDaoQianLi()}else{alert("提交失败。。请重试。。")}})}catch(u){}}else{$("#alloc_code_error").html("*外调序列号格式错误")}})}function showChaXunKKB(){changeButtonStyle("cha_xun_kkb");var e=getKKBList();var t=new String;for(var n=0;n<e.length;n++){t+='<div class="bmkkb_bu" ><a href="'+e[n].link+'" class="bmkkb"><p>'+e[n].name+"</p></a></div>"}$("#alloc_work_f").html("<div id='alloc_work_f_inner'></div>");$("#alloc_work_f_inner").hide().html(t).slideDown()}function showCancleAlloc(){function t(e){var t=/^\d{8}-[A-Z]{4}$/;return t.test(e)}changeButtonStyle("cancle_alloc");$("#alloc_work_f").html("<div id='alloc_work_f_inner'></div>");var e=new String;e+='	<div id="code_s_q">\n'+"		<h2>外调序列号</h2>\n"+'		<div id="code_tips">\n'+"			输入外调序列号:\n"+"		</div>\n"+'		<form method="post" action="#" name="code_input">\n'+'			<input type="text" id="alloc_code" name="alloc_code" />\n'+'			<div id="alloc_code_error" class="alloc_code_error"></div>\n'+'			<button type="button" id="alloc_code_sub" name="alloc_code_sub" class="alloc_sub_bu" title="外调序列号提交按钮">确定</button>\n'+"		</form>\n"+"		<hr />\n"+"	</div>\n"+'	<div id="decide_cancel_alloc"></div>\n';$("#alloc_work_f_inner").hide().html(e).slideDown();$("#alloc_code_sub").click(function(){var e=$("#alloc_code").val();if(true==t(e)){$("#alloc_code_error").html("");var n=postAllocCodeforCancel(e);var r=new String;if("exist"==n.exist){r+="<h2>确定取消此次外调</h2>\n"+'<div id="this_alloc_info">\n'+"<p>外调序列号："+n.code+"</p>"+"<p>外调生成时间:"+n.applyTime+"</p>"+"<p>操作员："+n.operator+"</p>"+"<p>外调申请部门："+arrDepartName[n.applyDepart-1]+"</p>"+"<p>外调工作时间："+n.workTime+"</p>"+"</div>"+'<button type="button" id="decide_cancel_alloc_sub" name="decide_cancel_alloc_sub" class="alloc_sub_bu" title="确定取消此次外调">'+'取消此次外调</button><div id="cancel_succeed"></div>'}else{r+="<h2>找不到"+e+"对应的外调!</h2>"}$("#decide_cancel_alloc").hide().html(r).slideDown();$("#decide_cancel_alloc_sub").click(function(){$(this).slideUp();if(true==cancelAlloc(e)){strCancelSucceed=new String;strCancelSucceed+="<p>外调"+e+"已经被取消</p>"+'<button type="button" id="confirm_the_result" name="confirm_the_result" class="alloc_sub_bu" title="确定并返回">'+"确定并返回</button>";$("#cancel_succeed").hide().html(strCancelSucceed).slideDown();$("#decide_cancel_alloc_sub").hide();$("#confirm_the_result").click(showCancleAlloc)}else{alert("操作失败，请重试。。");return false}})}else{$("#alloc_code_error").html("*外调序列号格式错误")}})}window.onload=allocateSystemInit;var exChangedButton="cha_xun_ke_biao";var arrDepartName=new Array("秘书处","人力资源部","宣传部","信息编辑部","学术部","体育部","KSC联盟","组织部","文娱部","公关部","心理服务部","主席团");var arrTypeName=new Array("干事","人力干事","部长级","主席团");var arrGenderName=new Array("不确定","女","男");var arrSKSJ=new Array({b:480,e:525},{b:535,e:580},{b:600,e:645},{b:655,e:700},{b:760,e:805},{b:815,e:860},{b:870,e:915},{b:925,e:970},{b:980,e:1025},{b:1035,e:1080},{b:1140,e:1185},{b:1195,e:1240},{b:1250,e:1295});var arrAllocRequire;var currentUser